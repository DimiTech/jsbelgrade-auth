<!DOCTYPE html>
<html>
<head>
    <title>OIDC Demo</title>
    <meta charset="UTF-8">
    <style>
        html, button, label {
            font-family: Cursive, monospace;
            font-size: 2em;
            text-align: center;
        }
        textarea {
            font-size: 0.5em;
            margin: 0.7em 0;
        }
        pre {
            display: inline-block;
            text-align: left;
        }
    </style>
    <script src="./lib/axios.min.js"></script>
    <script src="http://jsbelgrade.com/auth/js/keycloak.min.js"></script>
</head>
<body>
    <div> 
        <textarea id="access-token" placeholder="Access Token" cols="100"
            rows="15"></textarea>
        <br>
        <button id="api-call" autofocus>Call API</button>
        <button id="login-btn" autofocus>Log In</button>
        <button id="logout-btn" autofocus>Log Out</button>
        <br>
        <pre id="api-response">
            <!-- API response will be displayed here. -->
        </pre>
    </div>
<script>
    var callAPIButton    = document.getElementById('api-call')
    var APIResponseArea  = document.getElementById('api-response')
    var accessTokenInput = document.getElementById('access-token')
    var API_URL = '/api'
    callAPIButton.addEventListener('click', () => {
        axios.request({
            url: API_URL,
            headers: {
                "Authorization": "Bearer " + accessTokenInput.value 
            }
        })
        .then(res => {
            APIResponseArea.innerHTML = 'Status: ' + res.status + ' ' +
                res.statusText + '\nBody: ' + 
                JSON.stringify(res.data, null, 4) 
        })
        .catch(err => {
            let errorText
            if (err.response) {
                APIResponseArea.innerHTML = 'Status: ' + err.response.status +
                    ' ' + err.response.statusText
            } else {
                APIResponseArea.innerHTML = err.message
            }
        })
    })
</script>
<script>
    var loginBtn  = document.getElementById('login-btn')
    var logoutBtn = document.getElementById('logout-btn')

    var keycloak = Keycloak(
    {
        url: 'http://auth_server:8080/auth',
        realm: 'jsbelgrade',
        clientId: 'jsbelgrade'
    }
    // {
    //     "realm": "jsbelgrade",
    //     "auth-server-url": "http://auth_server:8080/auth",
    //     "ssl-required": "none",
    //     "resource": "jsbelgrade",
    //     "credentials": {
    //         "secret": "0eb83b4f-d4ce-457c-9bad-0aa37cd54367"
    //     }
    // }
    )
    keycloak.init().success(function(authenticated) {
        if (authenticated) showLogoutBtn()
        else showLoginBtn()

        loginBtn.addEventListener('click', function(event) {
            keycloak.login()
        })
        logoutBtn.addEventListener('click', function (event) {
            keycloak.logout()
        })
    })
    .error(function() {
        alert('failed to initialize')
    })

    function showLoginBtn() {
        loginBtn .style.display = 'inline'
        logoutBtn.style.display = 'none'
    }

    function showLogoutBtn() {
        loginBtn .style.display = 'none'
        logoutBtn.style.display = 'inline'
    }
</script>
</body>
</html>
